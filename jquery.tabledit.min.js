/*!
 * Tabledit v1.2.3 (https://github.com/markcell/jQuery-Tabledit)
 * Copyright (c) 2015 Celso Marques
 * Licensed under MIT (https://github.com/markcell/jQuery-Tabledit/blob/master/LICENSE)
 */

/**
 * @description Inline editor for HTML tables compatible with Bootstrap
 * @version 1.2.3
 * @author Celso Marques
 */

/**
 * The modified version
 * @version 1.2.5 (https://github.com/BluesatKV/jquery-tabledit)
 * @author BluesatKV
 */
if("undefined"==typeof jQuery)throw new Error("Tabledit requires jQuery library.");$.Tabledit={langs:{en:{btn_edit:"Edit",btn_delete:"Delete",btn_confirm:"Confirm",btn_save:"Save",btn_restore:"Restore"},de:{btn_edit:"",btn_delete:"",btn_confirm:"",btn_save:"",btn_restore:""},fr:{btn_edit:"",btn_delete:"",btn_confirm:"",btn_save:"",btn_restore:""},cz:{btn_edit:"Editovat",btn_delete:"Odstranit",btn_confirm:"Potvrdit",btn_save:"Ulo≈æit",btn_restore:"Obnovit"}}},function(t){"use strict";t.fn.Tabledit=function(e){function n(t){var e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"","'":"","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(t).replace(/[&<>"'`=\/]/g,function(t){return e[t]})}function i(e){var n=a.find(".tabledit-input").serialize();if(!n)return!1;n+="&action="+e;var i=s.onAjax(e,n);if(i===!1)return!1;s.method=s[e+"method"];var d=t.ajax({url:s.url,type:s.method,data:n,dataType:"json"});return d.done(function(t,n,i){e===s.buttons.edit.action&&(l.removeClass(s.dangerClass).addClass(s.warningClass),setTimeout(function(){a.find("tr."+s.warningClass).removeClass(s.warningClass)},1400)),s.onSuccess(t,n,i)}),d.fail(function(t,n,i){e===s.buttons["delete"].action?(o.removeClass(s.mutedClass).addClass(s.dangerClass),o.find(".tabledit-toolbar button").attr("disabled",!1),o.find(".tabledit-toolbar .tabledit-restore-button").hide()):e===s.buttons.edit.action&&l.addClass(s.dangerClass),s.onFail(t,n,i),console.log("Tabledit Ajax fail => "+n+" : "+i)}),d.always(function(){s.onAlways()}),d}if(!this.is("table"))throw new Error("Tabledit only works when applied to a table.");var a=this,d={url:window.location.href,editmethod:"post",deletemethod:"post",inputClass:"form-control input-sm",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",dangerClass:"danger",warningClass:"warning",mutedClass:"text-muted",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,lang:"en",escapehtml:!0,buttons:{edit:{"class":"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"></span>',action:"edit"},"delete":{"class":"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"></span>',action:"delete"},save:{"class":"btn btn-sm btn-success",html:""},restore:{"class":"btn btn-sm btn-warning",html:"Restore",action:"restore"},confirm:{"class":"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){},onSuccess:function(){},onFail:function(){},onAlways:function(){},onAjax:function(){}};if("undefined"==typeof e.columns)return console.log("Tabledit Jquery Plugin not initialize. Set required parameters."),this;e.lang&&e.lang in t.Tabledit.langs?e.lang=e.lang.toLowerCase():e.lang=d.lang;var s=t.extend(!0,d,e),l="undefined",o="undefined",r="undefined";if(s.editButton&&s.buttons.edit.html)var b=s.buttons.edit.html;else var b=t.Tabledit.langs[s.lang].btn_edit;if(s.deleteButton&&s.buttons["delete"].html)var u=s.buttons["delete"].html;else var u=t.Tabledit.langs[s.lang].btn_delete;if(s.confirmButton&&s.buttons.confirm.html)var c=s.buttons.confirm.html;else var c=t.Tabledit.langs[s.lang].btn_confirm;if(s.saveButton&&s.buttons.save.html)var f=s.buttons.save.html;else var f=t.Tabledit.langs[s.lang].btn_save;if(s.restoreButton&&s.buttons.restore.html)var p=s.buttons.restore.html;else var p=t.Tabledit.langs[s.lang].btn_restore;var h={columns:{identifier:function(){s.hideIdentifier&&a.find("th:nth-child("+parseInt(s.columns.identifier[0])+"1), tbody td:nth-child("+parseInt(s.columns.identifier[0])+"1)").hide();var e=a.find("tbody td:nth-child("+(parseInt(s.columns.identifier[0])+1)+")");e.each(function(){var e='<span class="tabledit-span tabledit-identifier">'+t.trim(t(this).text())+"</span>",n='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+s.columns.identifier[1]+'" value="'+t.trim(t(this).text())+'" disabled>';t(this).html(e+n),t(this).parent("tr").attr(s.rowIdentifier,t.trim(t(this).text()))})},editable:function(){for(var e=0;e<s.columns.editable.length;e++){var i=a.find("tbody td:nth-child("+(parseInt(s.columns.editable[e][0])+1)+")");i.each(function(){var i=t.trim(t(this).text()),i=s.escapehtml?n(t(this).text()):i;s.editButton||t(this).css("cursor","pointer");var a,d='<span class="tabledit-span">'+i+"</span>";"undefined"!=typeof s.columns.editable[e][2]?(a='<select class="tabledit-input '+s.inputClass+'" name="'+s.columns.editable[e][1]+'" style="display: none;" disabled>',t.each(jQuery.parseJSON(s.columns.editable[e][2]),function(e,n){n=t.trim(n),a+=i===n?'<option value="'+e+'" selected>'+n+"</option>":'<option value="'+e+'">'+n+"</option>"}),a+="</select>"):a='<input class="tabledit-input '+s.inputClass+'" type="text" name="'+s.columns.editable[e][1]+'" value="'+i+'" style="display: none;" disabled>',t(this).html(d+a),t(this).addClass("tabledit-view-mode")})}},toolbar:function(){if(s.editButton||s.deleteButton){var t="",e="",n="",i="",d="";0===a.find("th.tabledit-toolbar-column").length&&a.find("tr:first").append('<th class="tabledit-toolbar-column"></th>'),s.editButton&&(t='<button type="button" class="tabledit-edit-button '+s.buttons.edit["class"]+'" style="float: none;">'+b+"</button>"),s.deleteButton&&(e='<button type="button" class="tabledit-delete-button '+s.buttons["delete"]["class"]+'" style="float: none;">'+u+"</button>",d='<button type="button" class="tabledit-confirm-button '+s.buttons.confirm["class"]+'" style="display: none; float: none;">'+c+"</button>"),s.editButton&&s.saveButton&&(n='<button type="button" class="tabledit-save-button '+s.buttons.save["class"]+'" style="display: none; float: none;">'+f+"</button>"),s.deleteButton&&s.restoreButton&&(i='<button type="button" class="tabledit-restore-button '+s.buttons.restore["class"]+'" style="display: none; float: none;">'+p+"</button>");var l='<div class="tabledit-toolbar '+s.toolbarClass+'" style="text-align: left;">\n                                           <div class="'+s.groupClass+'" style="float: none;">'+t+e+"</div>\n                                           "+n+"\n                                           "+d+"\n                                           "+i+"\n                                       </div></div>";a.find("tbody>tr").append('<td style="white-space: nowrap; width: 1%;">'+l+"</td>")}}}},m={view:function(e){var n=t(e).parent("tr");t(e).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0),t(e).find(".tabledit-input").blur().hide().prop("disabled",!0),t(e).find(".tabledit-span").show(),t(e).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode"),s.editButton&&(n.find("button.tabledit-save-button").hide(),n.find("button.tabledit-edit-button").removeClass("active").blur())},edit:function(e){g.reset(e);var n=t(e).parent("tr");n.find(".tabledit-input.tabledit-identifier").prop("disabled",!1),t(e).find(".tabledit-span").hide();var i=t(e).find(".tabledit-input");i.prop("disabled",!1).show(),s.autoFocus&&i.focus(),t(e).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode"),s.editButton&&(n.find("button.tabledit-edit-button").addClass("active"),n.find("button.tabledit-save-button").show())}},v={reset:function(e){t(e).each(function(){var e=t(this).find(".tabledit-input"),n=t.trim(t(this).find(".tabledit-span").text());e.is("select")?e.find("option").filter(function(){return t.trim(t(this).text())===n}).attr("selected",!0):e.val(n),m.view(this)})},submit:function(e){var n=i(s.buttons.edit.action);n!==!1&&(t(e).each(function(){var e=t(this).find(".tabledit-input");e.is("select")?t(this).find(".tabledit-span").text(t.trim(e.find("option:selected").text())):t(this).find(".tabledit-span").text(e.val()),m.view(this)}),l=t(e).parent("tr"))}},g={reset:function(){a.find(".tabledit-confirm-button").hide(),a.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(e){g.reset(e),t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=i(s.buttons["delete"].action);t(e).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),n!==!1&&(t(e).parent("tr").addClass("tabledit-deleted-row"),t(e).parent("tr").addClass(s.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0),t(e).find(".tabledit-restore-button").show(),o=t(e).parent("tr"))},confirm:function(e){a.find("td.tabledit-edit-mode").each(function(){v.reset(this)}),t(e).find(".tabledit-delete-button").addClass("active"),t(e).find(".tabledit-confirm-button").show()},restore:function(e){t(e).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var n=i(s.buttons.restore.action);t(e).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),n!==!1&&(t(e).parent("tr").removeClass("tabledit-deleted-row"),t(e).parent("tr").removeClass(s.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),t(e).find(".tabledit-restore-button").hide(),r=t(e).parent("tr"))}};return h.columns.identifier(),h.columns.editable(),h.columns.toolbar(),s.onDraw(),s.deleteButton&&(a.on("click","button.tabledit-delete-button",function(e){if(e.handled!==!0){e.preventDefault();var n=t(this).hasClass("active"),i=t(this).parents("td");g.reset(i),n||g.confirm(i),e.handled=!0}}),a.on("click","button.tabledit-confirm-button",function(e){if(e.handled!==!0){e.preventDefault();var n=t(this).parents("td");g.submit(n),e.handled=!0}})),s.restoreButton&&a.on("click","button.tabledit-restore-button",function(e){e.handled!==!0&&(e.preventDefault(),g.restore(t(this).parents("td")),e.handled=!0)}),s.editButton?(a.on("click","button.tabledit-edit-button",function(e){if(e.handled!==!0){e.preventDefault();var n=t(this),i=n.hasClass("active");v.reset(a.find("td.tabledit-edit-mode")),i||t(n.parents("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){m.edit(this)}),e.handled=!0}}),a.on("click","button.tabledit-save-button",function(e){e.handled!==!0&&(e.preventDefault(),v.submit(t(this).parents("tr").find("td.tabledit-edit-mode")),e.handled=!0)})):(a.on(s.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(t){t.handled!==!0&&(t.preventDefault(),v.reset(a.find("td.tabledit-edit-mode")),m.edit(this),t.handled=!0)}),a.on("change","select.tabledit-input:visible",function(e){e.handled!==!0&&(v.submit(t(this).parent("td")),e.handled=!0)}),t(document).on("click",function(t){var e=a.find(".tabledit-edit-mode");e.is(t.target)||0!==e.has(t.target).length||v.reset(a.find(".tabledit-input:visible").parent("td"))})),a.on("keypress",function(t){var e=a.find(".tabledit-input:visible"),n=a.find(".tabledit-confirm-button");if(e.length>0)var i=e.parents("td");else{if(!(n.length>0))return;var i=n.parents("td")}switch(t.keyCode){case 9:s.editButton||(v.submit(i),m.edit(i.closest("td").next()));break;case 13:t.preventDefault(),v.submit(i);break;case 27:v.reset(i),g.reset(i)}}),this}}(jQuery);
